<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Slideshow gallery in a marker tooltip</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v2.2.1/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet' />
<link href='base.css' rel='stylesheet' />
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>


<style>
.popup {
  text-align:center;
  }
.popup .slideshow .image        { display:none; }
.popup .slideshow .image.active { display:block; }
.popup .slideshow img {
  width:100%;
  }
.popup .slideshow .caption {
  background:#eee;
  padding:10px;
  }
.popup .cycle {
  padding:10px 0 20px;
  }
  .popup .cycle a.prev { float:left; }
  .popup .cycle a.next { float:right; }
  h3.fancy {
  	margin-bottom: 0px !important;
  }
</style>

<div id='map'>
	
	<div class="fill-midnight dark pin-top z10">
<div class="limiter center pad2y">
	<h3 class="fancy">Berlin Trip</h3>
</div>

</div>

<!-- jQuery is required for this example. -->
<script src='https://code.jquery.com/jquery-1.11.0.min.js'></script>
<script>
L.mapbox.accessToken = 'pk.eyJ1IjoidGF0aWFuYSIsImEiOiJrWW1MQlNzIn0.nvwe9ZuqxDWX25LR3t3CFw';
var map = L.mapbox.map('map', 'mapbox.streets');

var myLayer = L.mapbox.featureLayer().addTo(map);

var geoJson = [{
    type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [13.415173, 52.531616 ]},
    "properties": {
        'title': 'Airbnb',
    	'subtitle': 'Metzer Straße 8, Berlin, Berlin 10405',
        'marker-color': '#39adcc',
        'marker-symbol': 'building',
        'marker-size': 'large',

        // Store the image url and caption in an array.
        'images': [
          ['https://a0.muscache.com/im/pictures/54035217/cb61aec6_original.jpg','building from the outside'],
          ['https://a2.muscache.com/im/pictures/54035158/503cb04e_original.jpg','kitchen']
        ]
    }
}, {
    type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [13.412803999999994, 52.522549]},
    "properties": {
        'title': 'Alexanderplatz',
        'subtitle':'Alexanderplatz is a large public square and transport hub in the central Mitte district of Berlin, near the Fernsehturm.',
        'marker-color': '#f9ac35',
        'marker-symbol': 'town-hall',
        'marker-size': 'large',
        'images': [
          ['http://xl.marvelgulp.com/wp-content/uploads/2012/09/Alexanderplatz-2.jpg', ' '],
          ['http://www.slr-foto.de/galerie-architektur/foto/alexanderplatz_6772.jpg', ' ']
        ]
	}
}, {
    type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [13.407122,52.520611]},
    "properties": {
        'title': 'St Mary’s Church',
        'subtitle':'St. Mary\'s Church, known in German as the Marienkirche, is a church in Berlin, Germany. ',
        'marker-color': '#f9ac35',
        'marker-symbol': 'town-hall',
        'marker-size': 'large',
        'images': [
          ['http://travelsofadam.com/wp-content/uploads/2012/04/neptunbrunnen-berlin.jpg', ' '],
          ['https://upload.wikimedia.org/wikipedia/commons/2/25/St_Marys_Church,_Berlin,_Germany_(6123623871).jpg', ' ']
        ]

    }
}, {
    type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [13.401078,52.519061]},
    "properties": {
        'title': 'Berlin Cathedral  - Dom',
        'subtitle':'Berlin Cathedral is the short name for the Evangelical Supreme Parish and Collegiate Church in Berlin, Germany. It is located on Museum Island in the Mitte borough ',
        'marker-color': '#f9ac35',
        'marker-symbol': 'town-hall',
        'marker-size': 'large',
        'images': [
          ['http://upload.wikimedia.org/wikipedia/commons/c/c4/Berliner_Dom_-_Berlin_Cathedral_(2012).JPG', ' '],
          ['http://onthreelegs.com/wp-content/uploads/2013/08/Berlin-Cathedral-1183.jpg', ' ']
        ]

    }
}, {
    type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [13.376187,52.518620]},
    "properties": {
        'title': 'Berlin Reichstag',
        'subtitle':'The Reichstag building is a historical edifice in Berlin, Germany, constructed to house the Imperial Diet, of the German Empire. It was opened in 1894 and housed the Diet until 1933, when it was severely damaged in a fire.',
        'marker-color': '#f9ac35',
        'marker-symbol': 'town-hall',
        'marker-size': 'large',
        'images': [
          ['https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Reichstag_building_Berlin_view_from_west_before_sunset.jpg/1280px-Reichstag_building_Berlin_view_from_west_before_sunset.jpg', ' '],
          ['http://pompei-hotels.com/travel-and-architecture-design/Berlin-Reichstag-Kupel-Mitter-Tour.jpg', ' ']
        ]

    }
}, {
    type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [13.377704,52.516275]},
    "properties": {
        'title': 'Berlin Brandenburg Gate',
        'subtitle':'The Brandenburg Gate is an 18th-century neoclassical triumphal arch in Berlin, and one of the best-known landmarks of Germany.',
        'marker-color': '#f9ac35',
        'marker-symbol': 'town-hall',
        'marker-size': 'large',
        'images': [
          ['https://upload.wikimedia.org/wikipedia/commons/9/99/BrandenburgerTorGold.JPG', ' '],
          ['http://www.local-life.com/berlin/pages/m.7285_brandenburg-gate.jpg', ' ']
        ]

    }
}, {
    type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [13.378713,52.513947]},
    "properties": {
        'title': 'Holocaust memorial',
        'subtitle':'The Memorial to the Murdered Jews of Europe, also known as the Holocaust Memorial, is a memorial in Berlin to the Jewish victims of the Holocaust, designed by architect Peter Eisenman and engineer Buro Happold',
        'marker-color': '#f9ac35',
        'marker-symbol': 'town-hall',
        'marker-size': 'large',
        'images': [
          ['http://blogs.cnnmexico.com/en-primer-plano/wp-content/uploads/2010/07/memorial_berlin1.jpg', ' '],
          ['http://www.historvius.com/images/original/1579-Holocaust-Memorial-Berlin-1.jpg', ' ']
        ]

    }
}, {
    type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [13.375739,52.509352]},
    "properties": {
        'title': 'Panoramapunkt at Potsdamer Platz',
        'subtitle':'The lift takes just 20 seconds to climb 100 metres in the air to give you an instant, wonderful view of the German capital. Many Berlin landmarks are visible from up here: the Brandenburg Gate, the Victory Column, Potsdamer Platz, and the TV Tower. If the weather’s clear, a good view of the entire Berlin panorama is guaranteed.',
        'marker-color': '#f9ac35',
        'marker-symbol': 'town-hall',
        'marker-size': 'large',
        'images': [
          ['http://www.panoramapunkt.de/images/pic_19780713094bea895c798f0.jpg', ' '],
          ['http://www.panoramapunkt.de/images/gallery/pic_19847288164cb83ce65e27b_big.jpg', ' ']
        ]

    }
}, {
    type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [13.353796, 52.506363]},
    "properties": {
        'title': 'Bauhaus Archiv',
        'subtitle':'Exhibitions on the history & influence of the Bauhaus school of architecture, design & art',
        'marker-color': '#f9ac35',
        'marker-symbol': 'town-hall',
        'marker-size': 'large',
        'images': [
          ['https://upload.wikimedia.org/wikipedia/commons/a/a7/Bauhaus_Archiv_Berlin_6.jpg', ' '],
          ['http://www.minimumblog.com/wp-content/uploads/2013/05/Bauhaus-Archiv-Berlin-ON-TYPE-Texte-zur-Typografie-14.jpg', ' ']
        ]

    }
}, {
    type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [ 13.33185, 52.507990]},
    "properties": {
        'title': 'Museum für Fotografie',
        'subtitle':'Exhibitions on the history & influence of the Bauhaus school of architecture, design & art',
        'marker-color': '#f9ac35',
        'marker-symbol': 'town-hall',
        'marker-size': 'large',
        'images': [
          ['http://www.berlin.de/binaries/asset/image_assets/2728501/source/1378204170/418x316/', ' '],
          ['http://www.thatgirlfromamsterdam.com/wp-content/uploads/2014/02/museum_fur_fotografie_Helmut_newton_berlin_.jpg', ' ']
        ]

    }
}, {
    type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [  13.425434,52.508760]},
    "properties": {
        'title': 'Eisfabrik Factory and Public Art',
        'subtitle':'',
        'marker-color': '#f9ac35',
        'marker-symbol': 'town-hall',
        'marker-size': 'large',
        'images': [
          ['https://irs2.4sqi.net/img/general/width960/50188575_ZoE7NXxuveARg7X-ctwQw2q2SHo7_QvPrHNxN5BUmRc.jpg', ' '],
          ['http://4.bp.blogspot.com/-gkSuc4146xw/UMOvufWLTlI/AAAAAAAACSo/cb4vjvqGkvk/s1600/DJL_00030407.jpg', ' '],
          ['http://www.uberlin.co.uk/wp-content/uploads/2013/10/tumblr_mlnnlvw5oA1s32f01o3_1280.jpg', ' ']
        ]

    }
}, {
    type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [  13.439695,52.505022]},
    "properties": {
        'title': 'East side Gallery - Wall',
        'subtitle':'The East Side Gallery is an international memorial for freedom. It is a 1.3 km long section of the Berlin Wall located near the centre of Berlin on Mühlenstraße in Friedrichshain-Kreuzberg.',
        'marker-color': '#f9ac35',
        'marker-symbol': 'town-hall',
        'marker-size': 'large',
        'images': [
          ['http://i.telegraph.co.uk/multimedia/archive/01518/east-side_1518175i.jpg', ' '],
          ['http://i2.wp.com/www.blog.oneholidayrentals.com/wp-content/uploads/The-East-Side-Gallery1.jpg', ' ']
        ]

    }
}, {
    type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [   13.446227,52.502276]},
    "properties": {
        'title': 'Oberbaumbrücke',
        'subtitle':'The Oberbaum Bridge is a double-deck bridge crossing Berlin\'s River Spree, considered one of the city\'s landmarks.',
        'marker-color': '#f9ac35',
        'marker-symbol': 'town-hall',
        'marker-size': 'large',
        'images': [
          ['https://upload.wikimedia.org/wikipedia/commons/thumb/a/a8/Oberbaumbr%C3%BCcke_%28Berlin_2011%29_1120-1000-%28120%29.jpg/1600px-Oberbaumbr%C3%BCcke_%28Berlin_2011%29_1120-1000-%28120%29.jpg', ' '],
          ['http://3.bp.blogspot.com/-24OwF4NqA2Q/T3lncA-91aI/AAAAAAAAALE/inPd9seeTnM/s1600/oberbaumbrucke-www.berlijn.blog_.nl_.jpg', ' ']
        ]

    }

}];

// Add custom popup html to each marker.
myLayer.on('layeradd', function(e) {
    var marker = e.layer;
    var feature = marker.feature;
    var images = feature.properties.images
    var slideshowContent = '';

    for(var i = 0; i < images.length; i++) {
        var img = images[i];

        slideshowContent += '<div class="image' + (i === 0 ? ' active' : '') + '">' +
                              '<img src="' + img[0] + '" />' +
                            '</div>';
    }

    // Create custom popup content
    var popupContent =  '<div id="' + feature.properties.id + '" class="popup">' +
                            '<h2>' + feature.properties.title + '</h2>' +
                            '<p>' + feature.properties.subtitle + '</p>' +
                            '<div class="slideshow">' +
                                slideshowContent +
                            '</div>' +
                            '<div class="cycle">' +
                                '<a href="#" class="prev">&laquo; Previous</a>' +
                                '<a href="#" class="next">Next &raquo;</a>' +
                            '</div>'
                        '</div>';

    // http://leafletjs.com/reference.html#popup
    marker.bindPopup(popupContent,{
        closeButton: false,
        minWidth: 320
    });
});

// Add features to the map
myLayer.setGeoJSON(geoJson);

$('#map').on('click', '.popup .cycle a', function() {
    var $slideshow = $('.slideshow'),
        $newSlide;

    if ($(this).hasClass('prev')) {
        $newSlide = $slideshow.find('.active').prev();
        if ($newSlide.index() < 0) {
            $newSlide = $('.image').last();
        }
    } else {
        $newSlide = $slideshow.find('.active').next();
        if ($newSlide.index() < 0) {
            $newSlide = $('.image').first();
        }
    }

    $slideshow.find('.active').removeClass('active').hide();
    $newSlide.addClass('active').show();
    return false;
});

map.setView([52.526, 13.383], 13);
</script>


</body>
</html>
